<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
    <meta charset="utf-8">
    <title>Static Chart</title>
</head>

<body>
    <h2>Price Chart</h2>
    <div id="tvchart"></div>
</body>
<script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
<script type="text/javascript" src="index.js"></script>

</html>

<script>
    //Pseudo code
    //Step 1: Define chart properties.
    //Step 2: Create the chart with defined properties and bind it to the DOM element.
    //Step 3: Add the CandleStick Series.
    //Step 4: Set the data and render.

    //Code
    const log = console.log;

    const chartProperties = {
        width: 1500,
        height: 600,
        timeScale: {
            timeVisible: true,
            secondsVisible: false,
        }
    }

    const domElement = document.getElementById('tvchart');
    const chart = LightweightCharts.createChart(domElement, chartProperties);
    const candleSeries = chart.addCandlestickSeries();


    // fetch(`http://127.0.0.1:9665/fetchAPI?endpoint=https://api.binance.com/api/v3/klines?symbol=ETHUSDT&interval=1d&limit=1000`)
    fetch(`/api/pair/{{ .pairAddress }}`)
        .then(res => res.json())
        .then(data => {
            const cdata = data.map(d => {
                return { time: d[0] / 1000, open: parseFloat(d[1]), high: parseFloat(d[2]), low: parseFloat(d[3]), close: parseFloat(d[4]) }
            });
            candleSeries.setData(cdata);
        })
        .catch(err => log(err))
</script>